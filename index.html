<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hu-Stiles Time?</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="images/site.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.css" rel="stylesheet" />
    <!DOCTYPE html>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Roboto', Arial, sans-serif;
        }

        /* Fullscreen map container */
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            z-index: 0; /* Below the content */
        }

        /* Overlay container for clocks and text */
        .overlay {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #fff;
            text-align: center;
            pointer-events: none; /* Prevents map blocking */
        }

        h1 {
            font-size: 2.2rem;
            margin: 0 1rem 1.5rem;
            line-height: 1.2;
            /* background: rgba(0, 0, 0, 0.5); */
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color:rgba(0, 0, 0, 1);
        }

        #headline span {
            color: #f18851;
        }

        #headline span.baba {
            color: #53a796;
        }

        .clocks {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 300px;
        }

        /* Prevent stacking on desktop */
        @media (min-width: 768px) {
            .clocks {
                flex-direction: row; /* Side-by-side layout for larger screens */
                justify-content: center;
                gap: 2rem;
                max-width: 100%; /* Allow clocks to spread out */
            }

            .clock-container {
                width: 150px; /* Ensures uniform clock widths */
            }
        }

        .clock-container {
            background: rgba(255, 255, 255, .5);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #fff;
            color: #555;
        }

        #la-clock-container {
            border-color: #53a796;
        }

        #taipei-clock-container {
            border-color: #f18851;
        }

        .clock {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .subhead {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .credits {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.9rem;
            color: #767575;
            /* background: rgba(0, 0, 0, 0.6); */
            padding: 0.5rem 0;
        }

        .credits a {
            color: #53a796;
            text-decoration: none;
        }

        .day {
            font-size: 1rem;
            margin-top: 0.2rem;
            color: #444;
            font-weight: 300;
        }

        .blink {
            animation: blink 1s steps(1, start) infinite;
        }

        @keyframes blink {
            10% {
                opacity: .5;
            }
        }
    </style>
</head>
<body>
    <!-- Fullscreen Map Container -->
    <div id="map"></div>

    <!-- Overlay Content -->
    <div class="overlay">
        <h1 id="headline">What time is it for <span class="baba">Baba</span>?</h1>
        <div class="clocks">
            <div class="clock-container" id="taipei-clock-container">
                <div class="subhead">Taipei</div>
                <div class="clock" id="taipei-clock">Loading...</div>
                <div class="day" id="taipei-day">Loading...</div>
            </div>
            <div class="clock-container" id="la-clock-container">
                <div class="subhead">Los Angeles</div>
                <div class="clock" id="la-clock">Loading...</div>
                <div class="day" id="la-day">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Credits -->
    <p class="credits">A Hu-Stiles production | <a href="https://github.com/stiles/our-time">About</a></p>

    <script>
        // Initialize Mapbox
        mapboxgl.accessToken = 'pk.eyJ1Ijoic3RpbGVzIiwiYSI6ImNsd3Rpc3V2aTAzeXUydm9sMHdoN210b2oifQ.66AJmPYxe2ixku1o7Rwdlg';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/stiles/cm4rd1ivk007w01su0ro8c9rm',
            center: [-175.03, 21.4],
            zoom: 2,
            interactive: false // Disable all map interactions
        });

        // Disable additional controls for redundancy
        map.scrollZoom.disable();
        map.dragPan.disable();
        map.doubleClickZoom.disable();
        map.keyboard.disable();
        map.touchZoomRotate.disable();

        // Update Clocks
        function formatTime(date) {
            const hours = date.getHours() % 12 || 12;
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const ampm = date.getHours() >= 12 ? 'pm' : 'am';
            return { hours, minutes, ampm }; // Return as an object
        }

        function updateClocks() {
            const headline = document.getElementById('headline');
            const names = ['<span class="baba">Baba</span>', '<span>Eva, Isa & Luna</span>'];
            headline.innerHTML = `What time is it for ${names[Math.floor(Date.now() / 5000) % names.length]}?`;

            const now = new Date();

            // Los Angeles
            const laTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
            const laFormatted = formatTime(laTime);
            document.getElementById('la-clock').innerHTML = 
                `${laFormatted.hours}<span class="blink">:</span>${laFormatted.minutes} ${laFormatted.ampm}`;
            document.getElementById('la-day').textContent = laTime.toLocaleString('en-US', { weekday: 'long' });

            // Taipei
            const taipeiTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Taipei' }));
            const taipeiFormatted = formatTime(taipeiTime);
            document.getElementById('taipei-clock').innerHTML = 
                `${taipeiFormatted.hours}<span class="blink">:</span>${taipeiFormatted.minutes} ${taipeiFormatted.ampm}`;
            document.getElementById('taipei-day').textContent = taipeiTime.toLocaleString('en-US', { weekday: 'long' });
        }

        setInterval(updateClocks, 1000);
        updateClocks();
    </script>
</body>
</html>
